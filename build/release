#!/bin/bash

npm run clean
npm run copy
# npm prune
# npm dedupe

DIST=".bin/public"
DOMAIN="http://ponyfoo.com"

# compile
mkdir -p .bin/temp
spritesmith
stylus client/css/all.styl -o $DIST/css --include-css --include client/css --compress
cleancss $DIST/css/all.css -o $DIST/css/all.css --s0
jadum views/**/*.jade -o .bin --no-debug --obj '{"basedir":"views"}'
taunus -o
browserify client/js/main.js --basedir client/js | uglifyjs > $DIST/js/all.js
reaver $DIST/img/* --manifest > .bin/temp/scarab
scourge --map .bin/temp/scarab .bin/{views,public/{css,js}} --base-path $DIST --domain $DOMAIN
reaver $DIST/{css,js}/* --manifest | scourge .bin/views/server --base-path $DIST --domain $DOMAIN
