#!/bin/bash

# locals
ENV="staging"
EMOJI="$(emoji-random)"

APP="~/apps/$ENV"
APP_VERSIONS="$APP/v"

# bump package.json
git add .
git commit -am "Pre-deploy commit because $EMOJI"
npm version patch -m "Upgrade to %s because deploy $EMOJI"
VERSION=$(cat package.json | jq -r .version)

APP_LATEST="$APP_VERSIONS/$VERSION"

# build distribution
# npm run $ENV
npm run release
npm run sync

echo "Deployed v$VERSION to $ENV"
