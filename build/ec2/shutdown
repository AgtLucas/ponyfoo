#!/bin/bash

NAME="ponyfoo-staging"
INSTANCE=$(aws ec2 describe-instances --filters Name=tag:Name,Values=$NAME)
INSTANCE_ID=$(echo "$INSTANCE" | jq -r .Reservations[0].Instances[0].InstanceId)
PUBLIC_IP=$(echo "$INSTANCE" | jq -r .Reservations[0].Instances[0].PublicIpAddress)

aws ec2 terminate-instances --instance-ids $INSTANCE_ID
aws ec2 delete-tags --resources $INSTANCE_ID --tags Key=Name
aws ec2 delete-key-pair --key-name $NAME
aws ec2 release-address --public-ip $PUBLIC_IP
